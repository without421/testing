#include <fcntl.h>
#include <sys/ioctl.h>
#include <termios.h>
#include <unistd.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
    if (argc < 2) return 1;
    
    // Open the target TTY (e.g., /dev/tty2)
    int fd = open(argv[1], O_WRONLY);
    if (fd < 0) return 1;

    char c;
    // Read from stdin (where xclip will pipe the data)
    while (read(0, &c, 1) > 0) {
        if (c == '\n' || c == '\r') {
            // Inject a semicolon and space instead of a newline
            char sep[2] = {';', ' '};
            ioctl(fd, TIOCSTI, &sep[0]);
            ioctl(fd, TIOCSTI, &sep[1]);
        } else {
            ioctl(fd, TIOCSTI, &c);
        }
    }

    close(fd);
    return 0;
}
